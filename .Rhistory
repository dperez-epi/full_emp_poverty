pweekpay = c('Positive weekpay' = 1, 'Zero weekpay' = 0),
phours1 = c('Positive hours, primary job' = 1, 'Zero hours' =0))
# count(cpsorg, pweekpay, emp)
set.seed(2)
cps_filtered <- cpsorg %>%
filter(selfemp0==0, selfemp0==0) %>%
filter((emp==1 & phours1== 1 & pweekpay==1) | (emp==0 & phours1==0 & pweekpay==0))# %>%
#  mutate(newmoney = ifelse(realwage0==0, yes = runif(nrow(.), min = -1, max = 0), no=realwage0))
# count(cps, pwages, phours1, emp)
bins_under65_nm <- cps_filtered %>%
filter(age<65) %>%
group_by(year) %>%
summarize(avg_wage_all = weighted.mean(realweekpay0, w=orgwgt/12, na.rm=TRUE),
ptile20 = weighted_quantile(realweekpay0, w = orgwgt/12, probs = 0.20, na.rm=TRUE),
ptile40 = weighted_quantile(realweekpay0, w = orgwgt/12, probs = 0.40, na.rm=TRUE),
ptile50 = weighted_quantile(realweekpay0, w = orgwgt/12, probs = 0.50, na.rm=TRUE),
ptile60 = weighted_quantile(realweekpay0, w = orgwgt/12, probs = 0.60, na.rm=TRUE),
ptile80 = weighted_quantile(realweekpay0, w = orgwgt/12, probs = 0.80, na.rm=TRUE),
n=n())
View(bins_under65_nm)
View(bins_under65_nm)
bins_under65_nm <- cps_filtered %>%
filter(age<65) %>%
group_by(year) %>%
summarize(avg_wage_all = weighted.mean(realweekpay0, w=orgwgt/12, na.rm=TRUE),
ptile20 = weighted_quantile(realweekpay0, w = orgwgt/12, probs = 0.20, na.rm=TRUE),
ptile40 = weighted_quantile(realweekpay0, w = orgwgt/12, probs = 0.40, na.rm=TRUE),
ptile50 = weighted_quantile(realweekpay0, w = orgwgt/12, probs = 0.50, na.rm=TRUE),
ptile60 = weighted_quantile(realweekpay0, w = orgwgt/12, probs = 0.60, na.rm=TRUE),
ptile80 = weighted_quantile(realweekpay0, w = orgwgt/12, probs = 0.80, na.rm=TRUE),
n=n())
bins_under65_nm <- cps_filtered %>%
filter(age<65) %>%
group_by(year) %>%
summarize(avg_wage_all = weighted.mean(realweekpay0, w=orgwgt/12, na.rm=TRUE),
ptile20 = weighted_quantile(realweekpay0, w = orgwgt/12, probs = 0.20, na.rm=TRUE),
ptile40 = weighted_quantile(realweekpay0, w = orgwgt/12, probs = 0.40, na.rm=TRUE),
ptile50 = weighted_quantile(realweekpay0, w = orgwgt/12, probs = 0.50, na.rm=TRUE),
ptile60 = weighted_quantile(realweekpay0, w = orgwgt/12, probs = 0.60, na.rm=TRUE),
ptile80 = weighted_quantile(realweekpay0, w = orgwgt/12, probs = 0.80, na.rm=TRUE),
n=n())
ptile50 <- cps_filtered %>%
filter(age<65) %>%
group_by(year) %>%
summarize(ptile50 = weighted_quantile(realweekpay0, w = orgwgt/12, probs = 0.50, na.rm=TRUE),
n=n())
cps_quants <- cps_filtered %>%
inner_join(bins_under65_nm, by='year') %>%
mutate(bins = ifelse(realweekpay0 <= ptile20, 1,
ifelse((realweekpay0 > ptile20 & realweekpay0 <= ptile40), 2,
ifelse((realweekpay0 > ptile40 & realweekpay0 <= ptile60), 3,
ifelse((realweekpay0 > ptile60 & realweekpay0 <= ptile80), 4, 5)))))
metrics <- cps_quants %>%
filter(age<65) %>%
group_by(year, bins) %>%
summarize(avg_hrly_pay = weighted.mean(realwage0, w = orgwgt/12, na.rm=TRUE),
avg_weekpay = weighted.mean(realweekpay0, w=orgwgt/12, na.rn=TRUE),
avg_hrs = weighted.mean(hourslw0, na.rm=TRUE),
share_positive_hours = mean(phours1, na.rm=TRUE),
n=n(),
wgt_n = sum(orgwgt/12),
epop = weighted.mean(emp, w=orgwgt/12, na.rm=TRUE),
cutoffs = max(realwage0)) %>%
pivot_wider(id_cols = year, names_from = bins, values_from = c(avg_hrly_pay, avg_weekpay, avg_hrs, n, wgt_n, epop, cutoffs))# %>%
View(metrics)
hrly_wage0_under65 <- cps_filtered %>%
filter(age<65) %>%
group_by(year) %>%
summarize(avg_wage_all = weighted.mean(realwage0, w=orgwgt/12, na.rm=TRUE),
ptile20 = weighted_quantile(realwage0, w = orgwgt/12, probs = 0.20, na.rm=TRUE),
ptile40 = weighted_quantile(realwage0, w = orgwgt/12, probs = 0.40, na.rm=TRUE),
ptile50 = weighted_quantile(realwage0, w = orgwgt/12, probs = 0.50, na.rm=TRUE),
ptile60 = weighted_quantile(realwage0, w = orgwgt/12, probs = 0.60, na.rm=TRUE),
ptile80 = weighted_quantile(realwage0, w = orgwgt/12, probs = 0.80, na.rm=TRUE),
ptile99 = weighted_quantile(realwage0, w = orgwgt/12, probs = 0.99, na.rm=TRUE),
share_positive_wages = weighted.mean(pwages, w = orgwgt/12, na.rm=TRUE))# %>%
View(bins_under65_nm)
View(bins_under65_nm)
summary(cps_filtered$realweekpay0)
View(cps_filtered)
cps_filtered <- cpsorg %>%
filter(selfemp0==0, selfemp0==0) %>%
filter((emp==1 & phours1== 1 & pweekpay==1) | (emp==0 & phours1==0 & pweekpay==0)) %>%
mutate(weekpay_rndm = ifelse(realwage0==0, yes = runif(nrow(.), min = -1, max = 0), no=realweekpay0))
set.seed(2)
cps_filtered <- cpsorg %>%
filter(selfemp0==0, selfemp0==0) %>%
filter((emp==1 & phours1== 1 & pweekpay==1) | (emp==0 & phours1==0 & pweekpay==0)) %>%
mutate(weekpay_rndm = ifelse(realwage0==0, yes = runif(nrow(.), min = -1, max = 0), no=realweekpay0))
# count(cps, pwages, phours1, emp)
bins_under65_nm <- cps_filtered %>%
filter(age<65) %>%
group_by(year) %>%
summarize(avg_wage_all = weighted.mean(weekpay_rndm, w=orgwgt/12, na.rm=TRUE),
ptile20 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.20, na.rm=TRUE),
ptile40 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.40, na.rm=TRUE),
ptile50 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.50, na.rm=TRUE),
ptile60 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.60, na.rm=TRUE),
ptile80 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.80, na.rm=TRUE),
n=n())
ptile50 <- cps_filtered %>%
filter(age<65) %>%
group_by(year) %>%
summarize(ptile50 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.50, na.rm=TRUE),
n=n())
cps_quants <- cps_filtered %>%
inner_join(bins_under65_nm, by='year') %>%
mutate(bins = ifelse(realweekpay0 <= ptile20, 1,
ifelse((realweekpay0 > ptile20 & realweekpay0 <= ptile40), 2,
ifelse((realweekpay0 > ptile40 & realweekpay0 <= ptile60), 3,
ifelse((realweekpay0 > ptile60 & realweekpay0 <= ptile80), 4, 5)))))
cps_meds <- cps_filtered %>%
inner_join(bin2_under65, by='year') %>%
mutate(bins = ifelse(realweekpay0 > ptile50, yes=1, no = 0))
bins_under65_nm <- cps_filtered %>%
filter(age<65) %>%
group_by(year) %>%
summarize(avg_wage_all = weighted.mean(weekpay_rndm, w=orgwgt/12, na.rm=TRUE),
ptile20 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.20, na.rm=TRUE),
ptile40 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.40, na.rm=TRUE),
ptile50 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.50, na.rm=TRUE),
ptile60 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.60, na.rm=TRUE),
ptile80 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.80, na.rm=TRUE),
n=n())
cps_quants <- cps_filtered %>%
inner_join(bins_under65_nm, by='year') %>%
mutate(bins = ifelse(realweekpay0 <= ptile20, 1,
ifelse((realweekpay0 > ptile20 & realweekpay0 <= ptile40), 2,
ifelse((realweekpay0 > ptile40 & realweekpay0 <= ptile60), 3,
ifelse((realweekpay0 > ptile60 & realweekpay0 <= ptile80), 4, 5)))))
ptile50 <- cps_filtered %>%
filter(age<65) %>%
group_by(year) %>%
summarize(ptile50 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.50, na.rm=TRUE),
n=n())
cps_meds <- ptile50 %>%
inner_join(bin2_under65, by='year') %>%
mutate(bins = ifelse(realweekpay0 > ptile50, yes=1, no = 0))
bins_under65_nm <- cps_filtered %>%
filter(age<65) %>%
group_by(year) %>%
summarize(avg_wage_all = weighted.mean(weekpay_rndm, w=orgwgt/12, na.rm=TRUE),
ptile20 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.20, na.rm=TRUE),
ptile40 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.40, na.rm=TRUE),
ptile50 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.50, na.rm=TRUE),
ptile60 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.60, na.rm=TRUE),
ptile80 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.80, na.rm=TRUE),
n=n())
ptile50 <- cps_filtered %>%
filter(age<65) %>%
group_by(year) %>%
summarize(ptile50 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.50, na.rm=TRUE),
n=n())
cps_quants <- cps_filtered %>%
inner_join(bins_under65_nm, by='year') %>%
mutate(bins = ifelse(realweekpay0 <= ptile20, 1,
ifelse((realweekpay0 > ptile20 & realweekpay0 <= ptile40), 2,
ifelse((realweekpay0 > ptile40 & realweekpay0 <= ptile60), 3,
ifelse((realweekpay0 > ptile60 & realweekpay0 <= ptile80), 4, 5)))))
cps_meds <- cps_filtered %>%
inner_join(ptile50, by='year') %>%
mutate(bins = ifelse(realweekpay0 > ptile50, yes=1, no = 0))
metrics <- cps_quants %>%
filter(age<65) %>%
group_by(year, bins) %>%
summarize(avg_hrly_pay = weighted.mean(realwage0, w = orgwgt/12, na.rm=TRUE),
avg_weekpay = weighted.mean(realweekpay0, w=orgwgt/12, na.rn=TRUE),
avg_hrs = weighted.mean(hourslw0, na.rm=TRUE),
share_positive_hours = mean(phours1, na.rm=TRUE),
n=n(),
wgt_n = sum(orgwgt/12),
cutoffs = max(realwage0)) %>%
pivot_wider(id_cols = year, names_from = bins, values_from = c(avg_hrly_pay, avg_weekpay, avg_hrs, n, wgt_n, cutoffs))# %>%
metrics <- cps_quants %>%
filter(age<65) %>%
group_by(year, bins) %>%
summarize(avg_hrly_pay = weighted.mean(realwage0, w = orgwgt/12, na.rm=TRUE),
avg_weekpay = weighted.mean(realweekpay0, w=orgwgt/12, na.rn=TRUE),
avg_hrs = weighted.mean(hourslw0, na.rm=TRUE),
share_positive_hours = mean(phours1, na.rm=TRUE),
n=n(),
wgt_n = sum(orgwgt/12),
cutoffs = max(realwage0)) %>%
pivot_wider(id_cols = year, names_from = bins, values_from = c(avg_hrly_pay, avg_weekpay, avg_hrs, n, wgt_n, cutoffs))# %>%
write_csv(here('data/metrics.csv'), col_names = TRUE)
metrics50 <- cps_merged2 %>%
filter(age<65) %>%
group_by(year, bins) %>%
summarize(avg_hrly_pay = weighted.mean(realwage0, w = orgwgt/12, na.rm=TRUE),
avg_weekpay = weighted.mean(realweekpay0, w=orgwgt/12, na.rn=TRUE),
avg_hrs = weighted.mean(hourslw0, na.rm=TRUE),
share_positive_hours = mean(phours1, na.rm=TRUE),
n=n(),
wgt_n = sum(orgwgt/12),
epop = weighted.mean(emp, w=orgwgt/12, na.rm=TRUE),
cutoffs = max(realwage0)) %>%
pivot_wider(id_cols = year, names_from = bins, values_from = c(avg_hrly_pay, avg_weekpay, avg_hrs, n, wgt_n, epop, cutoffs)) %>%
write_csv(here('data/metrics2.csv'), col_names = TRUE)
metrics50 <- cps_merged2 %>%
filter(age<65) %>%
group_by(year, bins) %>%
summarize(avg_hrly_pay = weighted.mean(realwage0, w = orgwgt/12, na.rm=TRUE),
avg_weekpay = weighted.mean(realweekpay0, w=orgwgt/12, na.rn=TRUE),
avg_hrs = weighted.mean(hourslw0, na.rm=TRUE),
share_positive_hours = mean(phours1, na.rm=TRUE),
n=n(),
wgt_n = sum(orgwgt/12),
epop = weighted.mean(emp, w=orgwgt/12, na.rm=TRUE),
cutoffs = max(realwage0)) %>%
pivot_wider(id_cols = year, names_from = bins, values_from = c(avg_hrly_pay, avg_weekpay, avg_hrs, n, wgt_n, epop, cutoffs))# %>%
cps_medians <- cps_filtered %>%
inner_join(ptile50, by='year') %>%
mutate(bins = ifelse(realweekpay0 > ptile50, yes=1, no = 0))
metrics50 <- cps_medians %>%
filter(age<65) %>%
group_by(year, bins) %>%
summarize(avg_hrly_pay = weighted.mean(realwage0, w = orgwgt/12, na.rm=TRUE),
avg_weekpay = weighted.mean(realweekpay0, w=orgwgt/12, na.rn=TRUE),
avg_hrs = weighted.mean(hourslw0, na.rm=TRUE),
share_positive_hours = mean(phours1, na.rm=TRUE),
n=n(),
wgt_n = sum(orgwgt/12),
epop = weighted.mean(emp, w=orgwgt/12, na.rm=TRUE),
cutoffs = max(realwage0)) %>%
pivot_wider(id_cols = year, names_from = bins, values_from = c(avg_hrly_pay, avg_weekpay, avg_hrs, n, wgt_n, epop, cutoffs))# %>%
View(metrics50)
View(metrics)
summary(cps_filtered, realweekpay0)
sd(cps_filtered$realweekpay0)
cps_filtered <- cpsorg %>%
filter(selfemp0==0, selfemp0==0) %>%
filter((emp==1 & phours1== 1 & pweekpay==1) | (emp==0 & phours1==0 & pweekpay==0)) %>%
mutate(weekpay_rndm = ifelse(realwage0==0, yes = rnorm(nrow(.), mean = mean(realweekpay0), sd = sd(realweekpay0)), no=realweekpay0))
bins_under65_nm <- cps_filtered %>%
filter(age<65) %>%
group_by(year) %>%
summarize(avg_wage_all = weighted.mean(weekpay_rndm, w=orgwgt/12, na.rm=TRUE),
ptile20 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.20, na.rm=TRUE),
ptile40 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.40, na.rm=TRUE),
ptile50 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.50, na.rm=TRUE),
ptile60 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.60, na.rm=TRUE),
ptile80 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.80, na.rm=TRUE),
n=n())
ptile50 <- cps_filtered %>%
filter(age<65) %>%
group_by(year) %>%
summarize(ptile50 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.50, na.rm=TRUE),
n=n())
cps_quants <- cps_filtered %>%
inner_join(bins_under65_nm, by='year') %>%
mutate(bins = ifelse(realweekpay0 <= ptile20, 1,
ifelse((realweekpay0 > ptile20 & realweekpay0 <= ptile40), 2,
ifelse((realweekpay0 > ptile40 & realweekpay0 <= ptile60), 3,
ifelse((realweekpay0 > ptile60 & realweekpay0 <= ptile80), 4, 5)))))
cps_medians <- cps_filtered %>%
inner_join(ptile50, by='year') %>%
mutate(bins = ifelse(realweekpay0 > ptile50, yes=1, no = 0))
metrics <- cps_quants %>%
filter(age<65) %>%
group_by(year, bins) %>%
summarize(avg_hrly_pay = weighted.mean(realwage0, w = orgwgt/12, na.rm=TRUE),
avg_weekpay = weighted.mean(realweekpay0, w=orgwgt/12, na.rn=TRUE),
avg_hrs = weighted.mean(hourslw0, na.rm=TRUE),
share_positive_hours = mean(phours1, na.rm=TRUE),
n=n(),
wgt_n = sum(orgwgt/12),
cutoffs = max(realwage0)) %>%
pivot_wider(id_cols = year, names_from = bins, values_from = c(avg_hrly_pay, avg_weekpay, avg_hrs, n, wgt_n, cutoffs))# %>%
write_csv(here('data/metrics.csv'), col_names = TRUE)
set.seed(2)
cps_filtered <- cpsorg %>%
filter(selfemp0==0, selfemp0==0) %>%
filter((emp==1 & phours1== 1 & pweekpay==1) | (emp==0 & phours1==0 & pweekpay==0)) %>%
mutate(weekpay_rndm = ifelse(realwage0==0, yes = rnorm(nrow(.), mean = mean(realweekpay0), sd = sd(realweekpay0)), no=realweekpay0))
# count(cps, pwages, phours1, emp)
bins_under65_nm <- cps_filtered %>%
filter(age<65) %>%
group_by(year) %>%
summarize(avg_wage_all = weighted.mean(weekpay_rndm, w=orgwgt/12, na.rm=TRUE),
ptile20 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.20, na.rm=TRUE),
ptile40 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.40, na.rm=TRUE),
ptile50 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.50, na.rm=TRUE),
ptile60 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.60, na.rm=TRUE),
ptile80 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.80, na.rm=TRUE),
n=n())
ptile50 <- cps_filtered %>%
filter(age<65) %>%
group_by(year) %>%
summarize(ptile50 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.50, na.rm=TRUE),
n=n())
cps_quants <- cps_filtered %>%
inner_join(bins_under65_nm, by='year') %>%
mutate(bins = ifelse(realweekpay0 <= ptile20, 1,
ifelse((realweekpay0 > ptile20 & realweekpay0 <= ptile40), 2,
ifelse((realweekpay0 > ptile40 & realweekpay0 <= ptile60), 3,
ifelse((realweekpay0 > ptile60 & realweekpay0 <= ptile80), 4, 5)))))
cps_medians <- cps_filtered %>%
inner_join(ptile50, by='year') %>%
mutate(bins = ifelse(realweekpay0 > ptile50, yes=1, no = 0))
View(ptile50)
View(ptile50)
View(bins_under65_nm)
quantiles <- cps_filtered %>%
filter(age<65) %>%
group_by(year) %>%
summarize(avg_wage_all = weighted.mean(weekpay_rndm, w=orgwgt/12, na.rm=TRUE),
ptile20 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.20, na.rm=TRUE),
ptile40 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.40, na.rm=TRUE),
ptile50 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.50, na.rm=TRUE),
ptile60 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.60, na.rm=TRUE),
ptile80 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.80, na.rm=TRUE),
n=n())
ptile50 <- cps_filtered %>%
filter(age<65) %>%
group_by(year) %>%
summarize(ptile50 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.50, na.rm=TRUE),
n=n())
cps_quants <- cps_filtered %>%
inner_join(quantiles, by='year') %>%
mutate(bins = ifelse(realweekpay0 <= ptile20, 1,
ifelse((realweekpay0 > ptile20 & realweekpay0 <= ptile40), 2,
ifelse((realweekpay0 > ptile40 & realweekpay0 <= ptile60), 3,
ifelse((realweekpay0 > ptile60 & realweekpay0 <= ptile80), 4, 5)))))
cps_medians <- cps_filtered %>%
inner_join(ptile50, by='year') %>%
mutate(bins = ifelse(realweekpay0 > ptile50, yes=1, no = 0))
View(quantiles)
metrics <- cps_quants %>%
filter(age<65) %>%
group_by(year, bins) %>%
summarize(avg_hrly_pay = weighted.mean(realwage0, w = orgwgt/12, na.rm=TRUE),
avg_weekpay = weighted.mean(realweekpay0, w=orgwgt/12, na.rn=TRUE),
avg_hrs = weighted.mean(hourslw0, na.rm=TRUE),
share_positive_hours = mean(phours1, na.rm=TRUE),
n=n(),
wgt_n = sum(orgwgt/12),
cutoffs = max(realwage0)) %>%
pivot_wider(id_cols = year, names_from = bins, values_from = c(avg_hrly_pay, avg_weekpay, avg_hrs, n, wgt_n, cutoffs))# %>%
write_csv(here('data/metrics.csv'), col_names = TRUE)
metrics50 <- cps_medians %>%
filter(age<65) %>%
group_by(year, bins) %>%
summarize(avg_hrly_pay = weighted.mean(realwage0, w = orgwgt/12, na.rm=TRUE),
avg_weekpay = weighted.mean(realweekpay0, w=orgwgt/12, na.rn=TRUE),
avg_hrs = weighted.mean(hourslw0, na.rm=TRUE),
share_positive_hours = mean(phours1, na.rm=TRUE),
n=n(),
wgt_n = sum(orgwgt/12),
epop = weighted.mean(emp, w=orgwgt/12, na.rm=TRUE),
cutoffs = max(realwage0)) %>%
pivot_wider(id_cols = year, names_from = bins, values_from = c(avg_hrly_pay, avg_weekpay, avg_hrs, n, wgt_n, epop, cutoffs))# %>%
quantiles_real <- cps_filtered %>%
filter(age<65) %>%
group_by(year) %>%
summarize(avg_wage_all = weighted.mean(realweekpay0, w=orgwgt/12, na.rm=TRUE),
ptile20 = weighted_quantile(realweekpay0, w = orgwgt/12, probs = 0.20, na.rm=TRUE),
ptile40 = weighted_quantile(realweekpay0, w = orgwgt/12, probs = 0.40, na.rm=TRUE),
ptile50 = weighted_quantile(realweekpay0, w = orgwgt/12, probs = 0.50, na.rm=TRUE),
ptile60 = weighted_quantile(realweekpay0, w = orgwgt/12, probs = 0.60, na.rm=TRUE),
ptile80 = weighted_quantile(realweekpay0, w = orgwgt/12, probs = 0.80, na.rm=TRUE),
n=n())
ptile50_real <- cps_filtered %>%
filter(age<65) %>%
group_by(year) %>%
summarize(ptile50 = weighted_quantile(realweekpay0, w = orgwgt/12, probs = 0.50, na.rm=TRUE),
n=n())
cps_quants_real <- cps_filtered %>%
inner_join(quantiles, by='year') %>%
mutate(bins = ifelse(realweekpay0 <= ptile20, 1,
ifelse((realweekpay0 > ptile20 & realweekpay0 <= ptile40), 2,
ifelse((realweekpay0 > ptile40 & realweekpay0 <= ptile60), 3,
ifelse((realweekpay0 > ptile60 & realweekpay0 <= ptile80), 4, 5)))))
cps_medians_real <- cps_filtered %>%
inner_join(ptile50, by='year') %>%
mutate(bins = ifelse(realweekpay0 > ptile50, yes=1, no = 0))
View(cps_quants_real)
View(ptile50_real)
metrics <- cps_quants_real %>%
filter(age<65) %>%
group_by(year, bins) %>%
summarize(avg_hrly_pay = weighted.mean(realwage0, w = orgwgt/12, na.rm=TRUE),
avg_weekpay = weighted.mean(realweekpay0, w=orgwgt/12, na.rn=TRUE),
avg_hrs = weighted.mean(hourslw0, na.rm=TRUE),
share_positive_hours = mean(phours1, na.rm=TRUE),
n=n(),
wgt_n = sum(orgwgt/12),
cutoffs = max(realwage0)) %>%
pivot_wider(id_cols = year, names_from = bins, values_from = c(avg_hrly_pay, avg_weekpay, avg_hrs, n, wgt_n, cutoffs))# %>%
View(metrics)
set.seed(2)
cps_filtered <- cpsorg %>%
filter(selfemp0==0, selfemp0==0) %>%
filter((emp==1 & phours1== 1 & pweekpay==1) | (emp==0 & phours1==0 & pweekpay==0)) %>%
mutate(weekpay_rndm = ifelse(realweekpay0==0, yes = rnorm(nrow(.), mean = -10, sd = 1), no=realweekpay0))
# count(cps, pwages, phours1, emp)
quintiles <- cps_filtered %>%
filter(age<65) %>%
group_by(year) %>%
summarize(avg_wage_all = weighted.mean(weekpay_rndm, w=orgwgt/12, na.rm=TRUE),
ptile20 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.20, na.rm=TRUE),
ptile40 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.40, na.rm=TRUE),
ptile50 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.50, na.rm=TRUE),
ptile60 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.60, na.rm=TRUE),
ptile80 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.80, na.rm=TRUE),
n=n())
View(quintiles)
ptile50 <- cps_filtered %>%
filter(age<65) %>%
group_by(year) %>%
summarize(ptile50 = weighted_quantile(weekpay_rndm, w = orgwgt/12, probs = 0.50, na.rm=TRUE),
n=n())
cps_quants <- cps_filtered %>%
inner_join(quantiles, by='year') %>%
mutate(bins = ifelse(realweekpay0 <= ptile20, 1,
ifelse((realweekpay0 > ptile20 & realweekpay0 <= ptile40), 2,
ifelse((realweekpay0 > ptile40 & realweekpay0 <= ptile60), 3,
ifelse((realweekpay0 > ptile60 & realweekpay0 <= ptile80), 4, 5)))))
cps_quants <- cps_filtered %>%
inner_join(quantiles, by='year') %>%
mutate(bins = ifelse(realweekpay0 <= ptile20, 1,
ifelse((realweekpay0 > ptile20 & realweekpay0 <= ptile40), 2,
ifelse((realweekpay0 > ptile40 & realweekpay0 <= ptile60), 3,
ifelse((realweekpay0 > ptile60 & realweekpay0 <= ptile80), 4, 5)))))
cps_medians <- cps_filtered %>%
inner_join(ptile50, by='year') %>%
mutate(bins = ifelse(realweekpay0 > ptile50, yes=1, no = 0))
metrics <- cps_quants_real %>%
filter(age<65) %>%
group_by(year, bins) %>%
summarize(avg_hrly_pay = weighted.mean(realwage0, w = orgwgt/12, na.rm=TRUE),
avg_weekpay = weighted.mean(realweekpay0, w=orgwgt/12, na.rn=TRUE),
avg_hrs = weighted.mean(hourslw0, na.rm=TRUE),
share_positive_hours = mean(phours1, na.rm=TRUE),
n=n(),
wgt_n = sum(orgwgt/12),
cutoffs = max(realwage0)) %>%
pivot_wider(id_cols = year, names_from = bins, values_from = c(avg_hrly_pay, avg_weekpay, avg_hrs, n, wgt_n, cutoffs))# %>%
metrics <- cps_quants %>%
filter(age<65) %>%
group_by(year, bins) %>%
summarize(avg_hrly_pay = weighted.mean(realwage0, w = orgwgt/12, na.rm=TRUE),
avg_weekpay = weighted.mean(realweekpay0, w=orgwgt/12, na.rn=TRUE),
avg_hrs = weighted.mean(hourslw0, na.rm=TRUE),
share_positive_hours = mean(phours1, na.rm=TRUE),
n=n(),
wgt_n = sum(orgwgt/12),
cutoffs = max(realwage0)) %>%
pivot_wider(id_cols = year, names_from = bins, values_from = c(avg_hrly_pay, avg_weekpay, avg_hrs, n, wgt_n, cutoffs))# %>%
metrics <- cps_quants %>%
filter(age<65) %>%
group_by(year, bins) %>%
summarize(avg_hrly_pay = weighted.mean(realwage0, w = orgwgt/12, na.rm=TRUE),
avg_weekpay = weighted.mean(realweekpay0, w=orgwgt/12, na.rn=TRUE),
avg_hrs = weighted.mean(hourslw0, na.rm=TRUE),
share_positive_hours = mean(phours1, na.rm=TRUE),
n=n(),
wgt_n = sum(orgwgt/12),
cutoffs = max(realweekpay0)) %>%
pivot_wider(id_cols = year, names_from = bins, values_from = c(avg_hrly_pay, avg_weekpay, avg_hrs, n, wgt_n, cutoffs))# %>%
metrics50 <- cps_medians %>%
filter(age<65) %>%
group_by(year, bins) %>%
summarize(avg_hrly_pay = weighted.mean(realwage0, w = orgwgt/12, na.rm=TRUE),
avg_weekpay = weighted.mean(realweekpay0, w=orgwgt/12, na.rn=TRUE),
avg_hrs = weighted.mean(hourslw0, na.rm=TRUE),
share_positive_hours = mean(phours1, na.rm=TRUE),
n=n(),
wgt_n = sum(orgwgt/12),
epop = weighted.mean(emp, w=orgwgt/12, na.rm=TRUE),
cutoffs = max(realwage0)) %>%
pivot_wider(id_cols = year, names_from = bins, values_from = c(avg_hrly_pay, avg_weekpay, avg_hrs, n, wgt_n, epop, cutoffs))# %>%
cps_quants <- cps_filtered %>%
inner_join(quintiles, by='year') %>%
mutate(bins = ifelse(realweekpay0 <= ptile20, 1,
ifelse((realweekpay0 > ptile20 & realweekpay0 <= ptile40), 2,
ifelse((realweekpay0 > ptile40 & realweekpay0 <= ptile60), 3,
ifelse((realweekpay0 > ptile60 & realweekpay0 <= ptile80), 4, 5)))))
metrics <- cps_quants %>%
filter(age<65) %>%
group_by(year, bins) %>%
summarize(avg_hrly_pay = weighted.mean(realwage0, w = orgwgt/12, na.rm=TRUE),
avg_weekpay = weighted.mean(realweekpay0, w=orgwgt/12, na.rn=TRUE),
avg_hrs = weighted.mean(hourslw0, na.rm=TRUE),
share_positive_hours = mean(phours1, na.rm=TRUE),
n=n(),
wgt_n = sum(orgwgt/12),
cutoffs = max(realweekpay0)) %>%
pivot_wider(id_cols = year, names_from = bins, values_from = c(avg_hrly_pay, avg_weekpay, avg_hrs, n, wgt_n, cutoffs))# %>%
metrics50 <- cps_medians %>%
filter(age<65) %>%
group_by(year, bins) %>%
summarize(avg_hrly_pay = weighted.mean(realwage0, w = orgwgt/12, na.rm=TRUE),
avg_weekpay = weighted.mean(realweekpay0, w=orgwgt/12, na.rn=TRUE),
avg_hrs = weighted.mean(hourslw0, na.rm=TRUE),
share_positive_hours = mean(phours1, na.rm=TRUE),
n=n(),
wgt_n = sum(orgwgt/12),
epop = weighted.mean(emp, w=orgwgt/12, na.rm=TRUE),
cutoffs = max(realwage0)) %>%
pivot_wider(id_cols = year, names_from = bins, values_from = c(avg_hrly_pay, avg_weekpay, avg_hrs, n, wgt_n, epop, cutoffs))# %>%
cps_filtered <- cpsorg %>%
filter(selfemp0==0, selfemp0==0) %>%
filter((emp==1 & phours1== 1 & pweekpay==1) | (emp==0 & phours1==0 & pweekpay==0)) %>%
mutate(weekpay_rndm = ifelse(realweekpay0==0, yes = rnorm(nrow(.), mean = -10, sd = 1), no=realweekpay0)) %>%
mutate(quints = xtile(weekpay_rndm, n = 5, wt = orgwgt/12))
count(cps_filtered, quints)
cps_filtered <- cpsorg %>%
filter(selfemp0==0, selfemp0==0) %>%
filter((emp==1 & phours1== 1 & pweekpay==1) | (emp==0 & phours1==0 & pweekpay==0)) %>%
mutate(weekpay_rndm = ifelse(realweekpay0==0, yes = rnorm(nrow(.), mean = -10, sd = 1), no=realweekpay0)) %>%
mutate(quints = xtile(weekpay_rndm, n = 2, wt = orgwgt/12))
count(cps_filtered, quints)
